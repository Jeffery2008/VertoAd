<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»ªè¡¨ç›˜ - VertoAD</title>
    <link rel="stylesheet" href="/static/css/admin.css">
    <script src="/static/js/component-loader.js"></script>
</head>
<body>
    <div class="admin-container">
        <header class="admin-header">
            <h1>ä»ªè¡¨ç›˜</h1>
            <div class="header-actions">
                <button onclick="generateKeys()" class="btn btn-primary">ç”Ÿæˆæ¿€æ´»ç </button>
            </div>
        </header>

        <div class="stats-grid">
            <div class="stats-card">
                <h3>å¹¿å‘Šä¸»æ•°é‡</h3>
                <div class="stats-value" id="advertiser-count">åŠ è½½ä¸­...</div>
            </div>
            <div class="stats-card">
                <h3>å‘å¸ƒè€…æ•°é‡</h3>
                <div class="stats-value" id="publisher-count">åŠ è½½ä¸­...</div>
            </div>
            <div class="stats-card">
                <h3>æ´»è·ƒå¹¿å‘Š</h3>
                <div class="stats-value" id="active-ads">åŠ è½½ä¸­...</div>
            </div>
            <div class="stats-card">
                <h3>24å°æ—¶æ”¶å…¥</h3>
                <div class="stats-value" id="revenue">åŠ è½½ä¸­...</div>
            </div>
        </div>

        <div class="section-header">
            <h2>æœ€è¿‘ç”¨æˆ·</h2>
        </div>

        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>ç”¨æˆ·å</th>
                        <th>é‚®ç®±</th>
                        <th>è§’è‰²</th>
                        <th>ä½™é¢</th>
                        <th>æ³¨å†Œæ—¶é—´</th>
                    </tr>
                </thead>
                <tbody id="userTableBody">
                    <!-- ç”¨æˆ·æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                </tbody>
            </table>
        </div>

        <div class="quick-actions">
            <h2>å¿«é€Ÿæ“ä½œ</h2>
            <div class="actions-grid">
                <a href="/admin/users.html" class="action-card">
                    <span class="action-icon">ğŸ‘¥</span>
                    <span class="action-text">ç”¨æˆ·ç®¡ç†</span>
                </a>
                <a href="/admin/errors.html" class="action-card">
                    <span class="action-icon">âš ï¸</span>
                    <span class="action-text">é”™è¯¯ç®¡ç†</span>
                </a>
                <a href="/admin/settings.html" class="action-card">
                    <span class="action-icon">âš™ï¸</span>
                    <span class="action-text">ç³»ç»Ÿè®¾ç½®</span>
                </a>
            </div>
        </div>
    </div>

    <script>
        // é¡µé¢åŠ è½½å®Œæˆåè·å–æ•°æ®
        document.addEventListener('DOMContentLoaded', () => {
            loadStats();
            loadUsers();
        });

        // åŠ è½½ç»Ÿè®¡æ•°æ®
        async function loadStats() {
            try {
                const response = await fetch('/api/admin/stats');
                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('advertiser-count').textContent = data.advertiser_count || 0;
                    document.getElementById('publisher-count').textContent = data.publisher_count || 0;
                    document.getElementById('active-ads').textContent = data.active_ads || 0;
                    document.getElementById('revenue').textContent = 'ï¿¥' + (data.revenue_24h || 0).toFixed(2);
                } else {
                    throw new Error(data.message || 'åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥: ' + error.message);
            }
        }

        // åŠ è½½ç”¨æˆ·æ•°æ®
        async function loadUsers() {
            try {
                const response = await fetch('/api/admin/users');
                const users = await response.json();
                
                if (response.ok) {
                    displayUsers(users);
                } else {
                    throw new Error(data.message || 'åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥: ' + error.message);
            }
        }

        // æ˜¾ç¤ºç”¨æˆ·æ•°æ®
        function displayUsers(users) {
            const tbody = document.getElementById('userTableBody');
            tbody.innerHTML = '';

            if (!users || users.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center">æ²¡æœ‰æ‰¾åˆ°ç”¨æˆ·</td></tr>';
                return;
            }

            users.forEach(user => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.username}</td>
                    <td>${user.email}</td>
                    <td>${translateRole(user.role)}</td>
                    <td>ï¿¥${parseFloat(user.balance).toFixed(2)}</td>
                    <td>${formatDate(user.created_at)}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // ç”Ÿæˆæ¿€æ´»ç 
        function generateKeys() {
            window.location.href = '/admin/generate-keys.html';
        }

        // è§’è‰²ç¿»è¯‘
        function translateRole(role) {
            const roles = {
                'admin': 'ç®¡ç†å‘˜',
                'advertiser': 'å¹¿å‘Šä¸»',
                'publisher': 'å‘å¸ƒè€…'
            };
            return roles[role] || role;
        }

        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
    </script>
</body>
</html> 