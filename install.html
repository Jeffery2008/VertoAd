<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HFI Ad Center Installation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding-top: 40px; }
        .install-form { max-width: 600px; margin: 0 auto; padding: 15px; }
        .form-group { margin-bottom: 1rem; }
    </style>
</head>
<body>
    <div class="container">
        <div class="install-form">
            <h2 class="text-center mb-4">HFI Ad Center Installation</h2>
            
            <div id="installationProgress" class="progress mb-4" style="display: none;">
                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
            </div>

            <div id="stepIndicator" class="alert alert-info">
                Please fill in the installation details below.
            </div>

            <form id="installForm">
                <!-- Database Configuration -->
                <h4 class="mb-3">Database Configuration</h4>
                <div class="form-group">
                    <label for="dbHost">Database Host</label>
                    <input type="text" class="form-control" id="dbHost" name="dbHost" value="localhost" required>
                </div>
                <div class="form-group">
                    <label for="dbName">Database Name</label>
                    <input type="text" class="form-control" id="dbName" name="dbName" value="hfi_ad_center" required>
                </div>
                <div class="form-group">
                    <label for="dbUser">Database Username</label>
                    <input type="text" class="form-control" id="dbUser" name="dbUser" required>
                </div>
                <div class="form-group">
                    <label for="dbPass">Database Password</label>
                    <input type="password" class="form-control" id="dbPass" name="dbPass" required>
                </div>

                <!-- Admin Account -->
                <h4 class="mb-3 mt-4">Admin Account</h4>
                <div class="form-group">
                    <label for="adminEmail">Admin Email</label>
                    <input type="email" class="form-control" id="adminEmail" name="adminEmail" required>
                </div>
                <div class="form-group">
                    <label for="adminUsername">Admin Username</label>
                    <input type="text" class="form-control" id="adminUsername" name="adminUsername" required>
                </div>
                <div class="form-group">
                    <label for="adminPassword">Admin Password</label>
                    <input type="password" class="form-control" id="adminPassword" name="adminPassword" required>
                </div>

                <!-- Site Configuration -->
                <h4 class="mb-3 mt-4">Site Configuration</h4>
                <div class="form-group">
                    <label for="siteUrl">Site URL</label>
                    <input type="url" class="form-control" id="siteUrl" name="siteUrl" placeholder="https://yourdomain.com" required>
                </div>
                <div class="form-group">
                    <label for="siteName">Site Name</label>
                    <input type="text" class="form-control" id="siteName" name="siteName" value="HFI Ad Center" required>
                </div>

                <button type="submit" class="btn btn-primary w-100 mt-4">Install</button>
            </form>

            <div id="installationResult" class="mt-4" style="display: none;"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('installForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Show progress bar
            const progressBar = document.getElementById('installationProgress');
            const progressBarInner = progressBar.querySelector('.progress-bar');
            progressBar.style.display = 'block';
            
            // Collect form data
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());
            
            try {
                // Disable form
                const form = e.target;
                form.querySelectorAll('input, button').forEach(el => el.disabled = true);
                
                // Update progress indicator
                document.getElementById('stepIndicator').textContent = 'Installation in progress...';
                progressBarInner.style.width = '20%';

                // Send installation request
                const response = await fetch('/api/v1/install_api.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                progressBarInner.style.width = '60%';

                const result = await response.json();
                
                if (result.success) {
                    progressBarInner.style.width = '100%';
                    document.getElementById('installationResult').innerHTML = `
                        <div class="alert alert-success">
                            <h4 class="alert-heading">Installation Successful!</h4>
                            <p>${result.message}</p>
                            <hr>
                            <p class="mb-0">
                                <a href="/admin/login" class="btn btn-success">Go to Admin Login</a>
                            </p>
                        </div>
                    `;
                } else {
                    throw new Error(result.message || 'Installation failed');
                }
            } catch (error) {
                progressBar.style.display = 'none';
                document.getElementById('installationResult').innerHTML = `
                    <div class="alert alert-danger">
                        <h4 class="alert-heading">Installation Failed</h4>
                        <p>${error.message}</p>
                    </div>
                `;
                // Re-enable form
                form.querySelectorAll('input, button').forEach(el => el.disabled = false);
            }
            
            document.getElementById('installationResult').style.display = 'block';
        });
    </script>
</body>
</html>
